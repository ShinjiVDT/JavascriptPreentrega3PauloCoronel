<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <title>Document</title>
</head>
<main>

  <div class="hamb">
    <span class="bar1"></span><span class="bar2"></span><span class="bar3"></span>
  </div>
  <div class="menu">
    <ul class="lista-menu">
      <li class="item-menu"><a href="#home">Home</a></li>
      <li class="item-menu"><a href="#news">News</a></li>
      <li class="item-menu"><a href="#contact">Contact</a></li>
      <li class="item-menu"><a href="#about">About</a></li>
    </ul>
  </div>

  <div class="avisoScroll">
    <h3>Scroll down!</h3>
  </div>
  <section class="section1">
    <div class="scrollUpInicio"></div>
    <div class="cuadrado">
      <div class="textInicioContainer">
        <h1 class="textInicio">Bienvenido a una historia miedo</h1>
      </div>
      <div class="wrapper1">
        <div class="cortinaIzq"></div>
        <div class="cortinaDer"></div>
        <button class="boton" id="buttonstart">

        </button>
        <div class="ojo">
          <div class="forma">
            <div class="cont">
            </div>
            <div class="ball">
              <div class="iris">
                <div class="int"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="bola"></div>
    <section class="section2">
    </section>
  </section>



  <section class="section3 wrapwrapper ">

    <div class="divAncho">
      <div class="amarillo"></div>

      <div class="bordeNegro"></div>
      <div class="content__text">
        <div class="blob-wrapper">
        </div>
        <div class="text--oscuridad">
          <div class="wrapperText1"></div>
          <div class="wrapperText2"></div>
          <div class="wrapperText3"></div>

          <div class="luz" id="luz"></div>
        </div>
      </div>

      <div class="cosa section3b">
        <div class="foco"></div>
        <div class="cosita"></div>
        <div class="cosita1">
          <h1>hola</h1>
        </div>
        <div class="cosita"></div>

      </div>
      <div class="cosa2">

        <div class="cosita"></div>
        <div class="cosita2">
          <h1>chau</h1>
        </div>
        <div class="cosita"></div>

      </div>

    </div>

  </section>
  <section class="section4">
  </section>
  <section class="section4">

  </section>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
<script>

  /* 
  
    luz.addEventListener("click", fosforo)
    let boolfosforo = false
  
    function fosforo() {
  
  
      if (boolfosforo === false) {
        let sec = `${getScrollAmount() / 1}`;
  
  
        gsap.to(".cosa", {
          width: "200vw",
          duration: 0,
        },)
  
  
        gsap.to(".luz", {
          filter: "invert(100%)",
          duration: 0,
        },)
  
        gsap.to(".text--oscuridad", {
          filter: "invert(100%)",
          duration: 0,
        })
  
        gsap.to(".amarillo", {
          backdropFilter: "sepia(100%)",
          duration: 10,
        })
  
        gsap.to(".luz", {
          backgroundColor: " #f9f9f9",
          boxShadow: "0 0 40px 20px #fff, 0 0 100px 50px #ff0",
        })
        gsap.to(".wrapperText1", {
          opacity: 1,
          duration: 20,
        },)
        gsap.to(".wrapperText2", {
          opacity: 1,
          duration: 20,
        }, "<")
        gsap.to(".wrapperText3", {
          opacity: 1,
          duration: 20,
        }, "<")
  
  
        gsap.to(".luz", {
          opacity: 1,
          ease: "bounce.out",
          duration: 10,
        })
  
  
  
        gsap.to(".luz", {
          duration: 10,
        },)
        boolfosforo === true
  
  
  
  
      }
    } */


  //MENU
  let button = document.getElementById("buttonstart");
  button.addEventListener("click", mouseojo);
  button.addEventListener("click", startAnimation);
  button.addEventListener("click", enableTimeline);


  let toggle = document.querySelector(".hamb");
  let boolmenu = false;
  let tlmenu = gsap.timeline()


  toggle.addEventListener("click", hamburguer)
  function hamburguer() {
    if (boolmenu === false) {
      gsap.to(".bar1", { duration: .2, width: "45px", height: "4px", top: "50%", left: "45%", rotate: "45deg" })
      gsap.to(".bar2", { duration: .2, width: "2px", })
      gsap.to(".bar3", { duration: .2, width: "45px", height: "4px", top: "50%", left: "45%", rotate: "-45deg" })
      tlmenu.to(".lista-menu", {
        duration: .4,
        opacity: .8,
        width: "100vw",
        ease: "power2.in",
      });
      tlmenu.to(".lista-menu li", {
        duration: .7,
        opacity: 1,
        stagger: .1,
        ease: "power3.in",
      })
      boolmenu = true
    } else {
      gsap.to(".bar1", { duration: .2, width: "37px", height: "4px", top: "30%", left: "50%", rotate: "0deg" })
      gsap.to(".bar2", { duration: .2, width: "37px", height: "4px", top: "50%", left: "50%", opacity: 1 })
      gsap.to(".bar3", { duration: .2, width: "37px", height: "4px", top: "70%", left: "50%", rotate: "0deg" })
      tlmenu.to(".lista-menu li", {
        duration: .7,
        opacity: 0,
        stagger: .1,
        ease: "power3.out",
      })
      tlmenu.to(".lista-menu", {
        duration: .5,
        width: 0,
        ease: "power2.out",
      });
      boolmenu = false
    }
  }

  const showAnimli = gsap.from('.hamb', {
    yPercent: -180,
    stagger: 0.1,
    duration: 0.2,
  }).progress(1);

  ScrollTrigger.create({
    start: "top top",
    end: 99999,
    onUpdate: (self) => {
      if (self.direction === -1) {
        showAnimli.play();
      } else {
        showAnimli.reverse();
      }
    }
  });


  //

  let boolfoco = false;
  let cosita1 = document.querySelector(".cosita");

  cosita1.addEventListener("click", foco)

  function foco() {
    if (boolfoco === false) {
      gsap.to(".foco", { duration: 2, "--circle": "100vmax" })
      tlmenu.to(".foco", {
        duration: .4,
        opacity: 0,
        ease: "power2.in",
      });
      tlmenu.to(".cosita", {
        duration: .7,
        opacity: 1,
        ease: "power3.in",
      })
      boolfoco = true
    } else {
      gsap.to(".foco", { duration: 2, "--circle": "10vmax" })
      tlmenu.to(".foco", {
        duration: .4,
        opacity: 1,

        ease: "power2.in",
      });
      tlmenu.to(".cosita", {
        duration: .5,
        scale: 1.5,
        ease: "power2.out",
      });
      boolfoco = false
    }
  }




  gsap.registerPlugin(ScrollTrigger);




  let contanimacion = document.querySelector(".cont");
  let irisanimacion = document.querySelector(".iris");

  let irisElement = document.querySelector(".iris");
  let bolaElement = document.querySelector(".bola");

  let avisoScroll = document.querySelector(".avisoScroll");



  function startAnimation() {

    let delayedCall;
    ScrollTrigger.create({
      start: "top top",
      end: 99999,

      onUpdate: self => {
        const velocity = self.getVelocity();
        // console.log("es" + velocity);
        if (velocity > 1) {
          gsap.to('.avisoScroll', { opacity: 0 })
        } else if (velocity < -1) {
          gsap.to('.avisoScroll', { opacity: 0 })
        }
        if (delayedCall)
          delayedCall.kill();
        delayedCall = gsap.delayedCall(1, () => gsap.to('.avisoScroll', { opacity: 1 }));
      }
    });


    contanimacion.classList.add("animatecont");
    irisanimacion.classList.add("animateiris");
  }



  let section1 = document.querySelector(".section1");
  let midWidth = Math.floor(section1.offsetWidth / 2);
  let midHeight = Math.floor(section1.offsetHeight / 2);
  let mousePos = {
    x: midWidth,
    y: midHeight
  };

  function mouseojo() {
    document.addEventListener("mousemove", updateMousePos);
  }

  function updateMousePos(event) {
    if (section1.contains(event.target)) {
      mousePos.x = event.clientX - section1.offsetLeft;
      mousePos.y = event.clientY - section1.offsetTop;
      transX = mousePos.x - midWidth;
      transY = mousePos.y - midHeight;
      let skewX = 0;
      if (transX > -30 && transX < 30 && transY < 0) {
        skewX = transX / 2;
      } else if (transX > -30 && transX < 30 && transY >= 0) {
        skewX = -(transX / 2);
      } else if (transX > 30) {
        skewX = -(transY / 2);
      } else if (transX < -30) {
        skewX = transY / 2;
      }
      if (transX >= 40) {
        transX = 40;
      } else if (transX <= -40) {
        transX = -40;
      }
      if (transY >= 10) {
        transY = 10;
      } else if (transY <= -20) {
        transY = -20;
      }

      if (skewX >= 15) {
        skewX = 15;
      } else if (skewX <= -15) {
        skewX = -15;
      }

      let iris = document.querySelector(".iris");
      iris.style.transform = "translateX(" + transX + "px) translateY(" + transY + "px) skewX(" + skewX + "deg) skewY(2deg)";

      let irisRect = irisElement.getBoundingClientRect();
      let irisLeft = irisRect.left + window.scrollX;
      let irisTop = irisRect.top + window.scrollY;
      bolaElement.style.left = irisLeft + 36 + "px";
      bolaElement.style.top = irisTop + 30 + "px";
      bolaElement.style.transform = "skew(" + skewX + "deg)"
      //skewY("+skewY+"deg)";

    }
  }

  function stopUpdateMousePos() {
    document.removeEventListener("mousemove", updateMousePos);
  }

  let deltaY

  var tl

  function enableTimeline() {


    tlscrollUpInicio = gsap.timeline({

      scrollTrigger: {
        markers: { startColor: "green", endColor: "green", fontSize: "18px", fontWeight: "bold", indent: 20 },
        scrub: 2,
        trigger: ".section1",
        start: "top top",
        end: "+=800",
        invalidateOnRefresh: true,
        pin: true,
      }
    })



      .to(".cortinaDer", {
        x: 350,
        rotate: -10,
        height: "120vh",
        ease: Power1.easeIn,
        duration: 10

      }, "<")

      .to(".cortinaIzq", {
        x: -350,
        rotate: 10,
        height: "120vh",
        duration: 10,
        ease: Power1.easeIn,

      }, "<")
 


      .to(".scrollUpInicio", {
        y: 10,
        height: "200vh",
        ease: Power1.easeIn,

      }, "<")




      .to(".textInicio", {
        y: 500,
        color: "#229954",
        scale: 2,
        duration: 10,
        opacity: .5,
        ease: Power1.easeIn,
      }, "<")


      .to(".ojo", {
        y: -250,
        duration: 10,
        ease: Power1.easeIn,
      }, "<")

      .to(".bola", {
        y: -250,
        duration: 10,
        ease: Power1.easeIn,
      }, "<")


      .to(".textInicio", {
        scale: 10,
        opacity: 0,
        duration: 10,
      })






    /*---TL1---*/
    /*     tlscrollUpInicio.add(getSection2pos, ) */

    // ScrollTrigger.refresh();

    /* FUNCION INSERTADA DIRECTAMENTE EN LA VARIABLE DE GSAP
        function getSection2pos() {
    
    
          let section2 = document.querySelector(".section2");
          let section2Rect = section2.getBoundingClientRect();
          let section2Top = section2Rect.top + window.scrollY;
          let bolaElement = document.querySelector(".bola");
          let bolaElementRect = bolaElement.getBoundingClientRect();
          let bolaElementBottom = bolaElementRect.bottom + window.scrollY;
           deltaY = section2Top - bolaElementBottom
          console.log("bbb" + deltaY)
         return deltaY} */

    tlscrollUpInicio.to(".bola", {
      y: () => {
        let section2 = document.querySelector(".section2");
        let section2Rect = section2.getBoundingClientRect();
        let section2Top = section2Rect.top + window.scrollY;
        let bolaElement = document.querySelector(".bola");
        let bolaElementRect = bolaElement.getBoundingClientRect();
        let bolaElementBottom = bolaElementRect.bottom + window.scrollY;
        deltaY = section2Top - bolaElementBottom
        return deltaY - 250
      },

      duration: 20,
      ease: "bounce.out",
      zIndex: 999,


    }, "<")


      .to(".bola", {
        opacity: 1,
        duration: 0.005,
      }, "<")


    tlscrollUpInicio.to(".section2", {
      backgroundColor: "black",
      duration: .005,
      ease: "none",
    }, "<+=7.3")
      .to(".textInicio", {
        color: "black",
      }, "<")

      .to(".scrollUpInicio", {
        backgroundColor: "black",
        duration: .005,
        ease: "none",
      }, "<")
      .to(".int", {
        display: "none",
        duration: 0.005,
      }, "<")



    tlscrollUpInicio.to(".bola", {

    }, "+=10")
    tl = gsap.timeline({
      scrollTrigger: {
        markers: { startColor: "violet", endColor: "violet", fontSize: "18px", fontWeight: "bold", indent: 20 },
        scrub: 1,
        trigger: ".ojo",
        start: "-50% top",
        end: "50% top",
        invalidateOnRefresh: true,
        // once: true,
        force3D: true,
        once: true,
        toggleActions: "play none none none",

      }
    })


    tl.to(".section3", {
      height: "100vh",
    },)

    tl.to(".blob-wrapper", {
      height: "1500px",
    },)

    tl.to(".text--oscuridad", {
      height: "auto",
    },)



    ScrollTrigger.refresh();


    tl.add(tl2)

      .add(stopUpdateMousePos)
  }



  const divAncho = document.querySelector(".divAncho");
  /*   console.log(divAncho.offsetWidth) */

  function getScrollAmount() {
    let divAnchoWidth = divAncho.scrollWidth;
    return -(divAnchoWidth - window.innerWidth);

  }


  /*---TL2---*/
  function tl2() {


    const blobWrapper = document.querySelector('.blob-wrapper')
    const numDivs = 15;
    let numDivsPerSecond = 1000;

    let tl2 = gsap.timeline({
      onStart: createDivs,
      scrollTrigger: {
        markers: { startColor: "red", endColor: "red", fontSize: "18px", fontWeight: "bold", indent: 20 },
        trigger: ".wrapwrapper",
        start: "top top",
        end: () => `+=${getScrollAmount() * -8}`,
        pin: true,
        pinSpacing: true,
        scrub: .1,
        force3D: true
      }
    })
    /* let tl2 = gsap.timeline({
      onStart: createDivs,
      scrollTrigger: {
   markers: { startColor: "red", endColor: "red", fontSize: "18px", fontWeight: "bold", indent: 20 },
        trigger: ".wrapwrapper",
        start: "top top",
        end: "+=1000",
        pin: true,
        pinSpacing: true,
        scrub: .1,
        force3D: true
      }
    }) */


    let i = 0;
    let a = 0;
    let e = 0;
    const timer = ms => new Promise(res => setTimeout(res, ms))
    async function createDivs(self) {
      for (let i = 0; i < 200; i++) {
        const blob = document.createElement("div");
        blob.classList.add("blob");
        blob.style.left = `${Math.random() * 101}%`;
        blob.style.width = `${Math.random() * 25}%`
        blob.style.setProperty('--blob-top', `${Math.random() * 70 + 1}%`);
        blob.style.setProperty('--blob-size', `${Math.random() * 10}%`);
        blobWrapper.appendChild(blob);
        await timer(8);
        setTimeout(() => {

          blob.remove()
        }, 10000)
      }
    }

    function update(e) {
      var x = e.clientX || e.touches[0].clientX
      var y = e.clientY || e.touches[0].clientY
      document.documentElement.style.setProperty('--cursorX', x + 'px')
      document.documentElement.style.setProperty('--cursorY', y + 'px')
    }

    function luz() {
      document.addEventListener('mousemove', update)
      document.addEventListener('touchmove', update)
    }



    /*   console.log("scroll " + getScrollAmount());
    console.log("scroll /3 " + sec)
    */

    tl2.to(".blob-wrapper", {

      opacity: 1,
      duration: 20,

    })
    tl2.to(".blob-wrapper", {
      backgroundColor: "rgb(0, 0, 0)",
      duration: 20,
    },)




    tl2.to(".text--oscuridad", {
      opacity: 0,
      ease: "bounce.out",
      duration: 5,
    })

      .to(".text--oscuridad", {
        filter: "invert(50%)",
        duration: 10,
      })

      .to(".text--oscuridad", {
        filter: "invert(0%)",
        duration: 0,
      })
      .to(".luz", {
        filter: "invert(0%)",
        opacity: 1,
        duration: 1,
      }, "<")

      .to(".text--oscuridad", {
        opacity: 1,
        duration: 8,
      })

    tl2.add(luz)

      .to(".text--oscuridad", {
        filter: "invert(100%)",
        duration: 0,
      })

      .to(".amarillo", {
        backdropFilter: "sepia(100%)",
        duration: 10,
      })



      .to(".luz", {
        filter: "invert(100%)",
        duration: 0,
      }, "<")
      .to(".luz", {
        backgroundColor: " #f9f9f9",
        boxShadow: "0 0 40px 20px #fff, 0 0 100px 50px #ff0",
      })

      .to(".wrapperText1", {
        opacity: 1,
        duration: 20,
      },)
      .to(".wrapperText2", {
        opacity: 1,
        duration: 20,
      }, "<")
      .to(".wrapperText3", {
        opacity: 1,
        duration: 20,
      }, "<")


      .to(".luz", {
        opacity: 1,
        ease: "bounce.out",
        duration: 10,
      })



      .to(".luz", {
        duration: 10,
      },)
    let sec = `${getScrollAmount() / 1}`;
    tl2.to(".divAncho", {
      x: -sec,
      duration: 3,
      ease: "none",
    })


      .to(".divAncho", {
        x: "-100vw",
        duration: 10,
        ease: "none",
      })

      .to(".text--oscuridad", {
        opacity: 0,
        ease: "bounce.out",
        duration: 5,
      })

      .to(".cosita1", {
        rotate: 360 * 2,
        duration: 3,
        ease: "none",

      })




      /*     .add(function gsamo() {
            let divAnchoWidth = divAncho.scrollWidth;
            let gsamo = divAnchoWidth - window.innerWidth;
          }) */
      .to(".foco", {
        "--circle": "10vmax",
        duration: 3,
        ease: "none",
      })
      .to(".cosita1", {
        rotate: 360 * 2,
        y: 300,
        duration: 10,
        ease: "none",

      })
      .to(".divAncho", {
        x: "-200vw",
        duration: 10,
        ease: "none",
        delay: 20
      })
      .to(".foco", {
        x: "100vw",
        duration: 10,
        ease: "none",
      }, "<")
      .to(".cosita2", {
        y: 150,
        duration: 10,
        ease: "none",
      })

      .to(".section4", {
        height: "100vh",
      },)

  }

  /* function tl3() {
    let tl3 = gsap.timeline({
      scrollTrigger: {
        markers: true,
        trigger: ".section3b",
        start: "left 70%",
        end: "left 30%",
        containerAnimation: scrollTween,
   
        pin: true,
        pinSpacing: true,
        scrub: .1,
        horizonatal: true,
      }
    })

    .to(".cosita1", {
      rotate: 360 * 2,
      duration: 3,
      ease: "none",

    })

  } */

</script>
</body>

</html>